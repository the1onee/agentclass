# دليل إضافة أقسام الشركات والأموال لنظام إدارة المندوب

## نظرة عامة
هذا الدليل يوضح كيفية إضافة قسمين جديدين لنظام إدارة المندوب الحالي:
1. **قسم الشركات**: لإدارة الشركات التي يتعامل معها المندوب
2. **قسم الأموال**: لإدارة المعاملات المالية بين المندوب والسائقين والشركات

## الخطوات المطلوبة للتطبيق

### 1. إضافة النماذج الجديدة (Models)
يجب إضافة النماذج التالية لملف `models.py` في تطبيق `port`:

#### النماذج المطلوبة:
- **Company**: لحفظ بيانات الشركات
- **DriverFinancialAccount**: الحساب المالي لكل سائق
- **DriverTransaction**: المعاملات المالية مع السائقين
- **CompanyTransaction**: المعاملات المالية مع الشركات
- **FinancialReport**: التقارير المالية

### 2. إنشاء ملفات الهجرة (Migrations)
بعد إضافة النماذج، يجب تشغيل الأوامر التالية:
```bash
python manage.py makemigrations
python manage.py migrate
```

### 3. إضافة النماذج للوحة الإدارة
في ملف `admin.py`:
```python
from .models import Company, DriverTransaction, CompanyTransaction, DriverFinancialAccount

admin.site.register(Company)
admin.site.register(DriverTransaction)
admin.site.register(CompanyTransaction)
admin.site.register(DriverFinancialAccount)
```

### 4. إنشاء النماذج (Forms)
إنشاء ملف `forms.py` أو إضافة للملف الموجود:
- CompanyForm
- DriverTransactionForm
- CompanyTransactionForm

### 5. إضافة الـ Views
إضافة الـ views المطلوبة لإدارة:
- قوائم الشركات والمعاملات
- إنشاء وتعديل البيانات
- التقارير المالية

### 6. إنشاء القوالب (Templates)
إنشاء المجلدات والقوالب التالية:
```
templates/port/
├── companies/
│   ├── list.html
│   ├── detail.html
│   ├── create.html
│   └── edit.html
├── financial/
│   ├── driver_transactions.html
│   ├── company_transactions.html
│   ├── driver_balance.html
│   └── reports.html
```

### 7. إضافة URLs
تحديث ملف `urls.py` لإضافة المسارات الجديدة.

### 8. تحديث لوحة التحكم
إضافة إحصائيات الشركات والأموال للوحة التحكم الرئيسية.

---

## البرومت الشامل للمطور

**استخدم هذا البرومت مع أي مطور أو AI للحصول على الكود كاملاً:**

---

# طلب تطوير: إضافة أقسام الشركات والأموال لنظام إدارة المندوب

## وصف المشروع الحالي
لدي نظام إدارة مندوب مطور بـ Django يحتوي على:
- نظام إدارة المستخدمين (مندوب، مشرف، مدير)
- إدارة أذونات التسليم (DeliveryOrder)
- إدارة الحاويات (Container)
- إدارة الشاحنات (Truck)
- إدارة السائقين (Driver)
- نظام الرحلات (Trip)

## المطلوب إضافته

### 1. قسم إدارة الشركات
أحتاج لإضافة قسم لإدارة الشركات التي يتعامل معها المندوب بالميزات التالية:

**بيانات الشركة:**
- اسم الشركة
- نوع الشركة (شحن، نقل، لوجستية، تجارية، تخليص، أخرى)
- رقم التسجيل (فريد)
- الرقم الضريبي
- الشخص المسؤول
- رقم الهاتف
- البريد الإلكتروني
- العنوان الكامل (المدينة، البلد)
- الحد الائتماني
- تاريخ بداية وانتهاء التعاقد
- حالة الشركة (نشط، غير نشط، معلق)

**الوظائف المطلوبة:**
- عرض قائمة الشركات مع البحث والفلترة
- إضافة شركة جديدة
- تعديل بيانات الشركة
- عرض تفاصيل الشركة مع المعاملات المالية
- حساب الرصيد الحالي لكل شركة

### 2. قسم إدارة الأموال

#### أ. الأموال بين المندوب والسائق
**أنواع المعاملات:**
- دفع للسائق
- خصم من السائق
- مكافأة
- غرامة
- سلفة
- بدل وقود
- صيانة

**البيانات المطلوبة:**
- نوع المعاملة
- المبلغ
- الوصف
- طريقة الدفع (نقدي، تحويل بنكي، شيك، موبايل)
- رقم المرجع
- حالة المعاملة (معلق، مكتمل، ملغي)
- تاريخ المعاملة وتاريخ الاستحقاق
- ربط بالرحلة (إن وجدت)

#### ب. الأموال بين المندوب والشركة
**أنواع المعاملات:**
- دخل من الشركة
- دفع للشركة
- عمولة
- رسوم خدمة
- غرامة
- استرداد
- سلفة

**البيانات المطلوبة:**
- نفس بيانات معاملات السائق
- إضافة رقم الفاتورة
- ربط بأمر التسليم والرحلة

### 3. الميزات المالية المطلوبة

**للسائقين:**
- حساب مالي لكل سائق (الرصيد الحالي، إجمالي المكاسب، إجمالي المستقطعات)
- تحديث تلقائي للرصيد عند إضافة معاملة
- تاريخ المعاملات لكل سائق

**للشركات:**
- حساب الرصيد الحالي تلقائياً
- تتبع المعاملات المتأخرة
- ربط المعاملات بأوامر التسليم والرحلات

**التقارير المالية:**
- تقرير ملخص السائقين
- تقرير ملخص الشركات
- تقرير شهري وسنوي
- تقرير الأرباح والخسائر
- إمكانية تصدير التقارير PDF/Excel

### 4. الواجهات المطلوبة

**قسم الشركات:**
- صفحة قائمة الشركات مع بحث وفلترة
- صفحة إضافة شركة جديدة
- صفحة تفاصيل الشركة مع المعاملات
- صفحة تعديل بيانات الشركة

**قسم الأموال:**
- صفحة معاملات السائقين
- صفحة معاملات الشركات
- صفحة أرصدة السائقين
- صفحة التقارير المالية
- نوافذ منبثقة لإضافة معاملة سريعة

**تحديثات لوحة التحكم:**
- إضافة إحصائيات الشركات
- إضافة إحصائيات مالية
- عرض المعاملات الأخيرة
- تنبيهات للمعاملات المتأخرة

### 5. المتطلبات التقنية

**القواعد والقيود:**
- كل مندوب يرى شركاته ومعاملاته فقط
- التحقق من صحة البيانات المالية
- منع الأرقام السالبة في المبالغ
- تسجيل تواريخ الإنشاء والتحديث
- دعم العملة العراقية (دينار)

**الأمان:**
- التحقق من صلاحيات المستخدم
- حماية البيانات المالية
- تسجيل العمليات الحساسة

**التصميم:**
- استخدام Bootstrap للتصميم
- واجهة عربية بالكامل
- تصميم متجاوب للموبايل
- أيقونات مناسبة للعمليات المالية

### 6. الملفات المطلوبة

يرجى إنشاء/تعديل الملفات التالية:
- `models.py` - إضافة النماذج الجديدة
- `forms.py` - نماذج الـ forms
- `views.py` - الـ views للوظائف الجديدة
- `urls.py` - المسارات الجديدة
- `admin.py` - تسجيل النماذج في لوحة الإدارة
- القوالب HTML للواجهات
- ملف الـ CSS للتصميم الإضافي

### 7. ملاحظات مهمة
- يجب أن يكون الكود متوافق مع النظام الحالي
- استخدام نفس أسلوب التصميم والبرمجة المستخدم في النظام
- إضافة التعليقات العربية في الكود
- اتباع معايير Django الأفضل
- إمكانية التوسع مستقبلاً

**المطلوب:** كود كامل وجاهز للتطبيق مع شرح خطوات التثبيت.

---
